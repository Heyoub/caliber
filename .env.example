# =============================================================================
# CALIBER Environment Configuration
# =============================================================================
#
# Copy this file to .env and fill in the values.
# NEVER commit .env to version control!
#
# For Railway deployment, set these in Railway Dashboard or via CLI:
#   railway variables set VARIABLE_NAME=value
#
# =============================================================================

# -----------------------------------------------------------------------------
# Environment
# -----------------------------------------------------------------------------
CALIBER_ENVIRONMENT=development
# Options: development, staging, production

# -----------------------------------------------------------------------------
# Database (PostgreSQL 18+ REQUIRED)
# -----------------------------------------------------------------------------
# BREAKING CHANGE (v0.4.0): CALIBER now requires PostgreSQL 18 or later.
# Earlier versions (13-17) are no longer supported.
#
# For local development:
CALIBER_DB_HOST=localhost
CALIBER_DB_PORT=5432
CALIBER_DB_NAME=caliber
CALIBER_DB_USER=caliber
CALIBER_DB_PASSWORD=caliber_dev_password
CALIBER_DB_POOL_SIZE=16

# For Railway (auto-set by PostgreSQL plugin):
# DATABASE_URL=${{Postgres.DATABASE_URL}}
# CALIBER_DB_HOST=${{Postgres.PGHOST}}
# CALIBER_DB_PORT=${{Postgres.PGPORT}}
# CALIBER_DB_NAME=${{Postgres.PGDATABASE}}
# CALIBER_DB_USER=${{Postgres.PGUSER}}
# CALIBER_DB_PASSWORD=${{Postgres.PGPASSWORD}}

# -----------------------------------------------------------------------------
# Redis (Caching + Pub/Sub)
# -----------------------------------------------------------------------------
# For local development:
CALIBER_REDIS_URL=redis://localhost:6379

# For Railway (auto-set by Redis plugin):
# CALIBER_REDIS_URL=${{Redis.REDIS_URL}}

# -----------------------------------------------------------------------------
# Authentication
# -----------------------------------------------------------------------------
# JWT secret for token signing (generate with: openssl rand -base64 32)
CALIBER_JWT_SECRET=CHANGE_ME_IN_PRODUCTION

# Auth provider: local, workos
CALIBER_AUTH_PROVIDER=local

# WorkOS configuration (required if CALIBER_AUTH_PROVIDER=workos)
# CALIBER_WORKOS_CLIENT_ID=client_xxxxx
# CALIBER_WORKOS_API_KEY=sk_xxxxx
# CALIBER_WORKOS_REDIRECT_URI=https://caliber.run/auth/callback
# CALIBER_WORKOS_WEBHOOK_SECRET=whsec_xxxxx
# CALIBER_WORKOS_WEBHOOK_TOLERANCE_SECS=300

# JWT token expiration in seconds (default: 3600 = 1 hour)
CALIBER_JWT_EXPIRATION_SECS=3600

# -----------------------------------------------------------------------------
# Billing (LemonSqueezy)
# -----------------------------------------------------------------------------
# LemonSqueezy store ID
# LEMONSQUEEZY_STORE_ID=xxxxx

# LemonSqueezy API key
# LEMONSQUEEZY_API_KEY=xxxxx

# LemonSqueezy webhook signing secret
# LEMONSQUEEZY_WEBHOOK_SECRET=xxxxx

# LemonSqueezy variant IDs for plans
# LEMONSQUEEZY_PRO_VARIANT_ID=xxxxx
# LEMONSQUEEZY_ENTERPRISE_VARIANT_ID=xxxxx

# -----------------------------------------------------------------------------
# API Configuration
# -----------------------------------------------------------------------------
# API server port
CALIBER_API_PORT=3000

# -----------------------------------------------------------------------------
# CORS Configuration (Production Hardening)
# -----------------------------------------------------------------------------
# Allowed origins for CORS (comma-separated).
# Leave empty for development (allows all origins).
# For production, specify exact origins:
CALIBER_CORS_ORIGINS=https://caliber.run,https://app.caliber.run

# Allow credentials in CORS requests (cookies, auth headers)
# Only enable if your frontend needs to send credentials
CALIBER_CORS_ALLOW_CREDENTIALS=false

# Max age for CORS preflight cache in seconds (default: 86400 = 24 hours)
CALIBER_CORS_MAX_AGE_SECS=86400

# -----------------------------------------------------------------------------
# Rate Limiting (Production Hardening)
# -----------------------------------------------------------------------------
# Enable/disable rate limiting (default: true)
CALIBER_RATE_LIMIT_ENABLED=true

# Rate limit for unauthenticated requests (per IP, per minute)
# Applies to requests without valid authentication
CALIBER_RATE_LIMIT_UNAUTHENTICATED=100

# Rate limit for authenticated requests (per tenant, per minute)
# Applies to requests with valid JWT or API key
CALIBER_RATE_LIMIT_AUTHENTICATED=1000

# Burst capacity - allows this many requests beyond the limit temporarily
# Helps handle legitimate traffic spikes
CALIBER_RATE_LIMIT_BURST=10

# -----------------------------------------------------------------------------
# Observability (Optional)
# -----------------------------------------------------------------------------
# Logging level
RUST_LOG=caliber_api=info,tower_http=info

# OpenTelemetry OTLP endpoint for distributed tracing
# CALIBER_OTLP_ENDPOINT=http://localhost:4317

# Trace sampling rate (0.0 to 1.0)
CALIBER_TRACE_SAMPLE_RATE=0.1

# Enable Prometheus metrics endpoint
CALIBER_METRICS_ENABLED=true

# -----------------------------------------------------------------------------
# LLM Services (Optional - for embedding generation)
# -----------------------------------------------------------------------------
# CALIBER_OPENAI_API_KEY=sk-xxxxx
# CALIBER_ANTHROPIC_API_KEY=sk-ant-xxxxx

# Embedding model to use
# CALIBER_EMBEDDING_MODEL=text-embedding-3-small

# -----------------------------------------------------------------------------
# Feature Flags (Optional)
# -----------------------------------------------------------------------------
# Enable WebSocket support
CALIBER_WEBSOCKET_ENABLED=true

# Enable gRPC endpoint
CALIBER_GRPC_ENABLED=true

# Enable GraphQL endpoint
CALIBER_GRAPHQL_ENABLED=false

# Enable MCP (Model Context Protocol) support
CALIBER_MCP_ENABLED=false
