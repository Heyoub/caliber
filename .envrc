# CALIBER Development Environment
# Auto-load environment variables via direnv

# Load .env file
dotenv

# Cargo/Rust cache on D: (WSL)
if [ -d /mnt/d ]; then
    export CARGO_HOME=/mnt/d/wsl-cache/cargo
    export RUSTUP_HOME=/mnt/d/wsl-cache/rustup
    export CARGO_TARGET_DIR=/mnt/d/wsl-cache/target/caliber
    mkdir -p "$CARGO_HOME" "$RUSTUP_HOME" "$CARGO_TARGET_DIR"
fi

# Ensure PostgreSQL is running (WSL only)
if command -v systemctl &> /dev/null && [[ "$(uname -r)" == *microsoft* ]]; then
    if ! pgrep -x "postgres" > /dev/null; then
        echo "Starting PostgreSQL..."
        sudo service postgresql start 2>/dev/null || true
    fi
fi

# Show status
echo "CALIBER dev environment loaded"
echo "  DB: ${CALIBER_DB_USER:-caliber}@${CALIBER_DB_HOST:-localhost}:${CALIBER_DB_PORT:-5432}/${CALIBER_DB_NAME:-caliber}"
echo "  API: http://localhost:${CALIBER_API_PORT:-3000}"
