# CALIBER Helm Chart Values
# Default configuration for production deployment

# Number of API replicas
replicaCount: 2

image:
  repository: ghcr.io/caliber-ai/caliber/caliber-api
  pullPolicy: IfNotPresent
  # Overrides the image tag (default is chart appVersion)
  tag: ""

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  # Create a service account
  create: true
  # Annotations for the service account
  annotations: {}
  # Name of the service account (generated if not set)
  name: ""

podAnnotations:
  prometheus.io/scrape: "true"
  prometheus.io/port: "3000"
  prometheus.io/path: "/metrics"

podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  runAsGroup: 1000
  fsGroup: 1000

securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: true
  runAsNonRoot: true
  runAsUser: 1000

service:
  type: ClusterIP
  port: 3000
  annotations: {}

ingress:
  enabled: false
  className: ""
  annotations: {}
    # kubernetes.io/ingress.class: nginx
    # kubernetes.io/tls-acme: "true"
    # cert-manager.io/cluster-issuer: letsencrypt-prod
  hosts:
    - host: caliber.local
      paths:
        - path: /
          pathType: Prefix
  tls: []
  #  - secretName: caliber-tls
  #    hosts:
  #      - caliber.local

resources:
  limits:
    cpu: 1000m
    memory: 512Mi
  requests:
    cpu: 100m
    memory: 128Mi

# Horizontal Pod Autoscaler
autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 10
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80

nodeSelector: {}

tolerations: []

affinity: {}

# CALIBER configuration
caliber:
  # Log level (trace, debug, info, warn, error)
  logLevel: info

  # JWT secret for authentication (generate with: openssl rand -base64 32)
  # If not set, will be auto-generated
  jwtSecret: ""

  # API keys for service authentication (comma-separated)
  apiKeys: ""

  # Database connection pool size
  dbPoolSize: 16

  # OpenTelemetry configuration
  telemetry:
    enabled: true
    # OTLP endpoint (e.g., http://jaeger:4317)
    otlpEndpoint: ""
    # Trace sampling rate (0.0 - 1.0)
    sampleRate: 0.1

  # Metrics configuration
  metrics:
    enabled: true

# PostgreSQL subchart configuration
postgresql:
  enabled: true
  auth:
    username: caliber
    password: ""
    database: caliber
    existingSecret: ""
  primary:
    persistence:
      enabled: true
      size: 10Gi
    resources:
      limits:
        cpu: 1000m
        memory: 1Gi
      requests:
        cpu: 250m
        memory: 256Mi

# Redis subchart configuration
redis:
  enabled: true
  auth:
    enabled: true
    password: ""
    existingSecret: ""
  master:
    persistence:
      enabled: true
      size: 1Gi
    resources:
      limits:
        cpu: 500m
        memory: 256Mi
      requests:
        cpu: 100m
        memory: 128Mi

# External database configuration (when postgresql.enabled=false)
externalDatabase:
  host: ""
  port: 5432
  database: caliber
  username: caliber
  password: ""
  existingSecret: ""
  existingSecretPasswordKey: password

# External Redis configuration (when redis.enabled=false)
externalRedis:
  host: ""
  port: 6379
  password: ""
  existingSecret: ""
  existingSecretPasswordKey: password

# Prometheus ServiceMonitor (requires prometheus-operator)
serviceMonitor:
  enabled: false
  interval: 30s
  scrapeTimeout: 10s
  labels: {}
  honorLabels: true

# PodDisruptionBudget
podDisruptionBudget:
  enabled: true
  minAvailable: 1
  # maxUnavailable: 1

# Liveness and readiness probes
livenessProbe:
  httpGet:
    path: /health/live
    port: http
  initialDelaySeconds: 10
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

readinessProbe:
  httpGet:
    path: /health/ready
    port: http
  initialDelaySeconds: 5
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 3

startupProbe:
  httpGet:
    path: /health/live
    port: http
  initialDelaySeconds: 5
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 30
